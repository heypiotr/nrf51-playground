<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v12.3.0: Experimental: BLE LE Secure Connections multirole example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v12.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s130"><a href="../s130/index.html">S130 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ble_sdk_app_multirole_lesc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Experimental: BLE LE Secure Connections multirole example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="whichSDs"><span>This example requires one of the following SoftDevices: <b>S130, S132</b></span></div><p><b>Important:</b> Before you run this example, make sure to <a class="el" href="getting_started_softdevice.html#getting_started_sd">program the SoftDevice</a>.</p>
<p>This example application demonstrates a simple application that uses LE Secure Connections (LESC) to enforce GAP Security Mode 1 Level 4, which requires pairing or bonding using LESC with man-in-the-middle (MITM) protection. The application uses the <a class="el" href="lib_peer_manager.html">Peer Manager</a> module, which supports LESC in both roles.</p>
<p>The application can act both as a peripheral or as a central depending on how the connection is set up. It will both advertise and scan when started up and after disconnection, and whichever role is established first will be selected for the next connection.</p>
<p>If you want the application to act as a peripheral, simply connect to it from a smart device or from another board running the same application. If you want the application to act as a central, simply provide a peripheral advertising with the Heart Rate Service UUID in its advertising data (this again can be either a smart device or another board running the same application).</p>
<p>The application includes the Heart Rate Service both as a server and as a client:</p>
<ul>
<li><a class="el" href="group__ble__hrs.html">Heart Rate Service</a></li>
<li><a class="el" href="group__ble__hrs__c.html">Heart Rate Service Client</a></li>
</ul>
<p>Security for the Client Characteristic Configuration Descriptor (CCCD) in the Heart Rate Measurement characteristic is set at Security Mode 1 Level 4, which requires LESC with MITM. This means that whenever the collector tries to enable notifications it will need first to secure it using those parameters.</p>
<h1><a class="anchor" id="project_multirole_lesc_setup"></a>
Setup</h1>
<p>Since the SoftDevice does not include the functionality required to calculate Elliptic Curve Cryptography (ECC) public keys and shared secrets, <b>an external library is required for this purpose</b>. Bindings and build files are provided for a well known open source library, micro-ecc, although the library itself is not provided.</p>
<p><b>Important note</b>: micro-ecc is an open source library. Its usage requires compliance with the license of the library as stated on the LICENSE.txt file included in micro-ecc. It is the developer's responsibility to ensure compliance with all the terms present.</p>
<p>To use micro-ecc with this project you will need to do the following:</p>
<ol type="1">
<li>Install a version of the GCC compiler toolchain for ARM. This is needed since micro-ecc itself can only be built with GCC. You can find a toolchain for your operating system in <a href="https://launchpad.net/gcc-arm-embedded/+download" target="_blank">ARM's Launchpad</a>.</li>
<li>Clone the <a href="https://github.com/kmackay/micro-ecc" target="_blank">micro-ecc GitHub repository</a> into <code><em>InstallFolder</em>\external\micro-ecc\micro-ecc</code>. The revision tested at the time of the release of this SDK version is <code>b6c0cdbe7d20af48b0c2a909a66ff00b093d1542</code>.</li>
<li>Depending on which IC you are using, and which toolchain you plan to build <b>your application</b> with, go into one of the folders provided:<ul>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf51_keil\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf52_keil\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf51_iar\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf52_iar\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf51_armgcc\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf52_armgcc\armgcc</code></li>
</ul>
</li>
<li>Run <code>make</code> to compile the library.</li>
<li>Open the project file with your toolchain of choice, it will be located here:<ul>
<li><code><em>InstallFolder</em>\examples\ble_central_and_peripheral\experimental\ble_app_multirole_lesc\<em>Board</em>\<em>Toolchain</em></code></li>
</ul>
</li>
<li>Compile and flash the appication.</li>
</ol>
<p><b>Note</b>: If you want to compile the micro-ecc library yourself using your own Makefile or other means, please make sure you use the same compilation options found in the Makefiles. This is specially important for preprocessor macros, and in particular <code>uECC_VLI_NATIVE_LITTLE_ENDIAN=1</code>, which needs to be set for the library to work properly with the example.</p>
<p>You can find the source code and the project file of the example in the following folder: <code>&lt;InstallFolder&gt;\examples\ble_central_and_peripheral\experimental\ble_app_multirole_lesc</code> </p>
<p>LED assignments:</p>
<ul>
<li>LED 1: ON if the central side is scanning.</li>
<li>LED 2: ON if the central side is connected to a peripheral.</li>
<li>LED 3: ON if the peripheral side is advertising.</li>
<li>LED 4: ON if the peripheral side is connected to a central.</li>
</ul>
<p>The application uses the following UART settings:</p>
<ul>
<li>
Baud rate: 115.200</li>
<li>
8 data bits</li>
<li>
1 stop bit</li>
<li>
No parity</li>
<li>
HW flow control: None</li>
</ul>
<h1><a class="anchor" id="ble_app_multirole_lesc_test"></a>
Testing</h1>
<p>Testing the application requires one of the following configurations:</p>
<ol type="1">
<li>A single board and a smart device that is compatible with LE Secure Connections<ul>
<li><b>1 application board</b>: nRF5 Development Kit board containing the S13x SoftDevice and running the present application.</li>
<li><b>1 smart device</b>: A smart device (Smartphone or Tablet) running an Operating System supporting LE Secure Connections. iOS supports it from version 8.2.</li>
</ul>
</li>
<li>2 boards running the application<ul>
<li><b>2 application boards</b>: nRF5 Development Kit boards containing the S13x SoftDevice and running this application.</li>
</ul>
</li>
</ol>
<p>Test the BLE LESC Multirole Example application by performing the following steps:</p>
<ol type="1">
<li>Compile the application and program both the SoftDevice and the application on the application board.</li>
<li>On the board, observe that LEDs 1 and 3 are on. This indicates that both the central and the peripheral side of the application are looking for peers.</li>
<li>Open an HRS-compatible application on your smart device (Master Control Panel, LightBlue or any other).</li>
<li>Either let the application board connect to your smart device (if the smart device is advertising the HRS UUID) or connect to the application board from the smart device's user interface.</li>
<li>If running the application board as a peripheral, try enable notifications on the HR Service from the smart device's application, this should trigger the activation of the bonding security procedure. If the application board is acting as a central, it should automatically try to enable notifications on the smart device's HR Service.</li>
<li>If numerical comparison is used, a log message (via UART or RTT) with the value to compare is displayed. Press Button 1 to validate it.</li>
<li>Observe that the bonding security procedure takes place. On the application board, the <a class="elRef" doxygen="tag_s332_offline.tag:../s332/" href="../s332/group___b_l_e___g_a_p___e_n_u_m_e_r_a_t_i_o_n_s.html#ggada486dd3c0cce897b23a887bed284fefa8958220152f7547da3b250b4f724877c">BLE_GAP_EVT_AUTH_STATUS</a> event should be displayed with <code>lv4</code> set to 1.</li>
<li>If you are testing with two sensor boards:<ol type="a">
<li>Compile the application and program both the SoftDevice and the application on the second sensor board.</li>
<li>Observe that the both boards are advertising and scanning.</li>
<li>Observe that one of the boards connects to the other and the bonding security procedure takes place. </li>
</ol>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon May 8 2017" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
