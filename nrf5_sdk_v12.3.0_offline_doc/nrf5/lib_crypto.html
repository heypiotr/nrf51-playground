<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v12.3.0: Cryptography library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v12.3.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s130"><a href="../s130/index.html">S130 SoftDevice API</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('lib_crypto.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Cryptography library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The cryptography library provides functions that implement several variants of public key cryptography. These cryptography functions are required for secure DFU. You can also include the library in your application (independently of the bootloader). The implementation utilizes a well-known open source library, micro-ecc.</p>
<p>The library supports the following cryptographic schemes:</p>
<ul>
<li>ECDSA (Elliptic Curve Digital Signature Algorithm), an algorithm to create and verify signatures for any kind of data (for example, a firmware image)</li>
</ul>
<ul>
<li>ECDH (Elliptic Curve Diffie-Hellmann), a key agreement protocol that allows to establish a shared secret over an insecure channel</li>
</ul>
<p>In addition, the library can be used to calculate a hash (or <em>digest</em>) of the input data, based on the SHA-256 hashing algorithm.</p>
<p>If you need more advanced security features, use the <a class="el" href="lib_cryptocell.html">Experimental: CryptoCell library</a>. That library uses cryptography hardware to perform cryptographic operations. However, it is available only on the nRF52840 SoC.</p>
<h1><a class="anchor" id="lib_crypto_concepts"></a>
Signing concepts</h1>
<p>If you plan to use the cryptography library, you should familiarize yourself with the general concepts of asymmetric cryptography. The following concepts are important to know:</p>
<dl>
<dt>Signature </dt>
<dd><p class="startdd">A <em>digital signature</em> attests the authenticity of a set of data. Usually, it contains a signed hash or digest of the same data. The recipient of the data can then verify the signature by hashing the data and comparing the hash to the one obtained from the signature.</p>
<p class="enddd">The signature is generated using a private key and a hashing algorithm. It can be verified using a public key.  </p>
</dd>
<dt>Private key </dt>
<dd><p class="startdd">A <em>private key</em> (also called <em>signing key</em> in the context of ECDSA) is a key that identifies its owner. You should never share your private key with anybody. When you use it to sign data, you affirm that the data is yours, because no one else knows the private key that is required for signing.</p>
<p class="enddd">To be understood by the cryptography library, private keys must be based on one of the curves defined in <a class="el" href="group___n_r_f___c_r_y_p_t_o___c_u_r_v_e_s.html">NRF_CRYPTO_CURVES</a>. Currently, only the secp256r1 (also called NIST P-256) curve is supported. See <a href="http://csrc.nist.gov/groups/ST/toolkit/documents/dss/NISTReCur.pdf" target="_blank">Recommended elliptic curves for federal government use</a>, <a href="http://www.secg.org/sec2-v2.pdf" target="_blank">SEC 2: Recommended Elliptic Curve Domain Parameters</a>, and other sources for detailed information about this curve.  </p>
</dd>
<dt>Public key </dt>
<dd><p class="startdd">A <em>public key</em> (also called <em>verification key</em> in the context of ECDSA) is openly available and can be used to verify the input data based on the signature and the hash of the input data.</p>
<p class="enddd">The public key is calculated based on the private key. This means that if you plan to send signed data, you must create a public key and share it with the recipient so that the recipient can verify the signature.  </p>
</dd>
<dt>Shared secret </dt>
<dd><p class="startdd">A <em>shared secret</em>, or a shared key, is a key that is known only to the involved parties. The shared secret can be negotiated over an insecure channel between parties that each have a public-private key pair. After the shared secret is calculated on both sides, it can be used to encrypt communication between the parties.</p>
<p class="enddd">Shared secrets are currently not used in secure DFU, but they can be used in different contexts (for example, they are required for <em>Bluetooth</em> LE Secure Connections).  </p>
</dd>
</dl>
<h1><a class="anchor" id="lib_crypto_key"></a>
Working with keys</h1>
<p>The cryptography library requires private and public keys. A public key can be computed from a private key, but the private key must always be provided. The library requires keys to be supplied as little-endian array of bytes along with a length (see <a class="el" href="structnrf__crypto__key__t.html">nrf_crypto_key_t</a> for more information).</p>
<p>If your keys should be valid for only one device or even only one connection, you can generate them at run time. Simply generate a random number as private key and compute the corresponding public key by calling <a class="el" href="group__nrf__crypto.html#ga48e910f56d37088b99960b09bac49284">nrf_crypto_public_key_compute</a>.</p>
<p>If you need static keys for use on multiple devices, you should generate the keys externally. The following example commands use Nordic Semiconductor's nrfutil tool (see the <a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.tools/dita/tools/nrfutil/nrfutil_intro.html">nrfutil documentation</a>) to generate keys based on the secp256r1 curve:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Generate a private key in c:\vault\priv.pem</span></div>
<div class="line"><span class="preprocessor"></span>nrfutil keys generate c:\vault\priv.pem</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Display the generated private key (in little-endian format)</span></div>
<div class="line"><span class="preprocessor"></span>nrfutil keys display --key sk --format hex c:\vault\priv.pem</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Display the generated private key (in code format to be</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># used with nrf_crypto)</span></div>
<div class="line"><span class="preprocessor"></span>nrfutil keys display --key sk --format code c:\vault\priv.pem</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Display the public key that corresponds to the generated private key</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># (in little-endian format)</span></div>
<div class="line"><span class="preprocessor"></span>nrfutil keys display --key pk --format hex c:\vault\priv.pem</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Display the public key that corresponds to the generated private key</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># (in code format to be used with nrf_crypto)</span></div>
<div class="line"><span class="preprocessor"></span>nrfutil keys display --key pk --format code c:\vault\priv.pem</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Write the public key that corresponds to the generated private key</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># to the file public_key.c (in code format)</span></div>
<div class="line"><span class="preprocessor">nrfutil keys display --key pk --format code c:\vault\priv.pem --out_file public_key.c</span></div>
</div><!-- fragment --><p>You can also generate keys using OpenSSL. See the OpenSSL documentation for instructions on how to generate a private key. Issue the following command to display the contents of the .pem key file: </p>
<div class="fragment"><div class="line">openssl ec -in c:\safe\priv.pem -text -noout</div>
</div><!-- fragment --><p>This command will display both the private and the public key in big-endian format. To use these keys with the cryptography library, you must reverse the byte order. Also, the public key will be prefixed by a byte with the value "0x04", which you should ignore.</p>
<p>Make sure to store the private key securely and with limited access. If the private key is lost, you cannot reproduce it and therefore cannot provide signed data anymore.</p>
<h1><a class="anchor" id="lib_crypto_installing"></a>
Installing micro-ecc</h1>
<p>micro-ecc is an open source library that is required to use the cryptography library. When using micro-ecc, you must ensure compliance with the license of the library as stated in the LICENSE.txt file that is included in micro-ecc.</p>
<p>The cryptography library expects to find the compiled micro-ecc library in <code><em>InstallFolder</em>\external\micro-ecc\micro-ecc</code>.</p>
<p>To install micro-ecc, complete the following steps:</p>
<ol type="1">
<li>Install version 4.9-2015-q3-update of the GCC compiler toolchain for ARM. You can use <a href="https://launchpad.net/gcc-arm-embedded/+download" target="_blank">ARM's Launchpad</a> to find the toolchain for your operating system.</li>
<li>Make sure that <code>make</code> is installed (see, for example, <a href="http://www.mingw.org/" target="_blank">MinGW</a>, <a href="https://www.gnu.org/software/make/" target="_blank">GNU Make</a>, or <a href="https://developer.apple.com/xcode/" target="_blank">Xcode</a>).</li>
<li>Clone the <a href="https://github.com/kmackay/micro-ecc" target="_blank">micro-ecc GitHub repository</a> into <code><em>InstallFolder</em>\external\micro-ecc\micro-ecc</code>.</li>
<li>Enter the subdirectory for the SoC and the toolchain that you are using to build your application:<ul>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf51_keil\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf52_keil\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf51_iar\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf52_iar\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf51_armgcc\armgcc</code></li>
<li><code><em>InstallFolder</em>\external\micro-ecc\nrf52_armgcc\armgcc</code></li>
</ul>
</li>
<li>Run <code>make</code> to compile the micro-ecc library.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>If you compile the micro-ecc library without using the provided Makefiles, make sure to use the default compilation options with -Os and optimization level 3. If you change the preprocessor macros (most importantly, <code>uECC_VLI_NATIVE_LITTLE_ENDIAN=1</code>), the library might not work properly.</dd></dl>
<h1><a class="anchor" id="lib_crypto_using"></a>
Library usage</h1>
<p>Before you can use the cryptography library, you must initialize it.</p>
<p>To create a public key from a private key, call <a class="el" href="group__nrf__crypto.html#ga48e910f56d37088b99960b09bac49284">nrf_crypto_public_key_compute</a> and specify which curve to use. This public key should be shared with other applications to enable them to verify signed data. Remember though that you should not share your private key, so calculating public keys in an application can be a risk.</p>
<p>To sign data, first call <a class="el" href="group__nrf__crypto.html#gaa271e08a868b8a5d5fe13511b79d495d">nrf_crypto_hash_compute</a> and specify which hashing algorithm to use. This function creates a hash (or digest) of the data. Next, create a signature for the hash by calling <a class="el" href="group__nrf__crypto.html#gaf86d1c7fee775a1fdbc243197ff776f0">nrf_crypto_sign</a> with your private key and the curve that you want to use as input. To verify the signature, the other application must first calculate the hash of the data (using <a class="el" href="group__nrf__crypto.html#gaa271e08a868b8a5d5fe13511b79d495d">nrf_crypto_hash_compute</a>) and then call <a class="el" href="group__nrf__crypto.html#gad912fbc98d29f3583a4aa7b0f9e27e10">nrf_crypto_verify</a> with the computed hash and your public key as input.</p>
<p>To calculate a shared secret between two applications, each application must call <a class="el" href="group__nrf__crypto.html#ga4387fe92beb398979bc658587f6d369b">nrf_crypto_shared_secret_compute</a> with their own private key and the other application's public key as input. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Mon May 8 2017" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
